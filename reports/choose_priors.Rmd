---
title: "Choose priors"
author: "Lucas A. Nell"
date: "7/4/2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# source(".Rprofile")
```
```{r library_pkgs, warning=FALSE}
suppressPackageStartupMessages({
    library(aphidreps)
})
```


## Growth rates

From data sent to me from A.R. Ives related to this paper:

Meisner, M. H., J. P. Harmon, and A. R. Ives. 2014. Temperature effects on
long-term population dynamics in a parasitoid–host system.
*Ecological Monographs* __84__:457–476.

For fecundity, juvenile survival, and adult survival, the dataset had low and high
estimates.
I created two Leslie matrices, one with all of the high estimates and another
with all the lower estimates.
For each of these Leslie matrices, I estimated the intrinsic daily rate of increase
($r$) in aphid populations in the lab as $r = \log(\lambda)$, where $\lambda$ is the
dominant eigenvector of the matrix.
Thus I have fast and slow estimates of population growth, and from these I estimated
the mean and standard deviation of the population-growth parameter.
If the clonal lines from Meisner et al. (2014) are representative of the lines
we currently have, and if these Leslie matrices truly represent the edges of possible
$r$ values, then this standard deviation should be an upper estimate.
The SE of $r$ is what I'll use for the standard deviation of the mean.


```{r load_leslies}
fast <- read_csv("data-raw/leslie_fast.csv", col_names = FALSE,
                 col_types = cols(.default = col_double())) %>% 
    as.matrix() %>% 
    eigen() %>% 
    .[["values"]] %>% 
    .[1] %>% 
    Re() %>% 
    log()
slow <- read_csv("data-raw/leslie_slow.csv", col_names = FALSE,
                 col_types = cols(.default = col_double())) %>% 
    as.matrix() %>% 
    eigen() %>% 
    .[["values"]] %>% 
    .[1] %>% 
    Re() %>% 
    log()
fast; slow
mean(c(fast, slow)); sd(c(fast, slow))
sd(c(fast, slow)) / sqrt(2)
```


The cauchy distribution with SD = 0.005 seems about right for sampling the among-line SD.

```{r R0_sd_plot}
compare_priors(sd(c(fast, slow)) / sqrt(2), 0.005, xlim = c(0, 0.05)) +
    geom_vline(xintercept = sd(c(fast, slow)) / sqrt(2))
```


## Density dependence

In my experience, we usually get a max of ~500 aphids on a plant that's been cut down to
3 sets of leaves.
So I used $1 / 500 = 0.002$ for alpha mean.
I used a normal distribution with SD (of the mean) of 0.0005 because this plot
looks about right.
We sometimes see >1000 or <100 aphids as max values for a replicate, but these
are rare and not likely to be mean values.


```{r density_plot}
compare_priors(0.002, 0.0005, xlim = c(0, 0.01)) +
    geom_vline(xintercept = 0.002)
```


For the among-line variability, I think SD = 0.001 fits best
because it generates values of 0.01 and very close to zero more commonly.

```{r density_plot_sd}
compare_priors(0.002, 0.001, xlim = c(0, 0.01)) +
    geom_vline(xintercept = 0.002)
```


So for the among-line SD distribution, I used a cauchy distribution with mean = 0.001
and SD = 0.0005 because it looks most reasonable to me.

```{r density_plot_sd2}
compare_priors(0.001, 0.0005, xlim = c(0, 0.005)) +
    geom_vline(xintercept = 0.001)
```



## Process error

I'm not really sure what this should be, but based on simulations, a value of 1 would
be very high.
Thus I chose a cauchy distribution with 0.1 as the mean and SD because
this appears about right.

```{r process_error_plot}
compare_priors(0.1, 0.1, xlim = c(0, 2)) +
    geom_vline(xintercept = 0.1)
```


## Plant effects

```{r beta_plot}
compare_priors(0.1, 0.1, xlim = c(0, 2)) +
    geom_vline(xintercept = 0.1)
```


```{r}
growth %>% 
    group_by(line, rep) %>% 
    summarize(Nm = max(N)) %>% 
    group_by(line) %>% 
    summarize(mu = mean(1 / Nm),
              sigma = sd(1 / Nm),
              n = n()) %>% 
    identity()
```

